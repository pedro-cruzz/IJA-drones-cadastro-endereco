<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema UVIS - Oceano Azul</title>
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='img/logo_oceanoazul.png') }}"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
      <div class="container-fluid">
        {% if current_user.is_authenticated %}
        <button
          class="btn btn-outline-primary me-3 d-none d-lg-block"
          type="button"
          id="sidebarToggle"
          aria-label="Toggle Sidebar"
        >
          <i class="bi bi-list fs-5"></i>
        </button>
        {% endif %}

        <a
          class="navbar-brand d-flex align-items-center gap-3"
          href="{{ url_for('main.dashboard') }}"
        >
          <img
            src="{{ url_for('static', filename='img/logo_oceanoazul.png') }}"
            alt="OceanoAzul Logo"
            height="50"
            id="navbar-logo"
            class="d-inline-block align-text-top"
          />
          <span class="fs-4 fw-bold text-primary">OceanoAzul</span>
        </a>

        <button
          class="navbar-toggler border-0"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav align-items-center gap-3">
            
            {% if current_user.is_authenticated %}
                <li class="nav-item d-lg-none">
                  <a class="nav-link" href="{{ url_for('main.dashboard') }}">
                    <i class="bi bi-house-door me-2"></i>Dashboard
                  </a>
                </li>
                {% if current_user.role == 'admin' %}
                <li class="nav-item d-lg-none">
                  <a class="nav-link" href="{{ url_for('main.relatorios') }}">
                    <i class="bi bi-graph-up me-2"></i>Relatórios
                  </a>
                </li>
                {% endif %}

                <li class="nav-item">
                  <span class="nav-link text-secondary">
                    <i class="bi bi-person-circle me-1"></i>
                    Olá, <strong>{{ current_user.name }}</strong>
                  </span>
                </li>

                <li class="nav-item">
                  <button
                    id="toggleDarkMode"
                    class="btn btn-outline-primary btn-sm rounded-pill"
                  >
                    <i class="bi bi-moon-stars"></i>
                  </button>
                </li>

                <li class="nav-item border-start ps-3 d-none d-lg-block"></li>
                
                <li class="nav-item">
                  <a
                    class="btn btn-outline-danger btn-sm rounded-pill px-3 fw-bold"
                    href="{{ url_for('main.logout') }}"
                  >
                    Sair <i class="bi bi-box-arrow-right ms-1"></i>
                  </a>
                </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1060; margin-top: 70px;">
        {% with messages = get_flashed_messages(with_categories=true) %} 
        {% if messages %} 
          {% for category, message in messages %}
          <div
            class="alert alert-{{ category }} alert-dismissible fade show shadow border-0"
            role="alert"
            style="min-width: 300px;"
          >
            {% if category == 'success' %}
              <i class="bi bi-check-circle-fill me-2"></i>
            {% elif category == 'danger' %}
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {% else %}
              <i class="bi bi-info-circle-fill me-2"></i>
            {% endif %}
            
            {{ message }}
            
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endfor %} 
        {% endif %} 
        {% endwith %}
    </div>

    <div class="{% if current_user.is_authenticated %}app-wrapper{% endif %}">
        
        {% if current_user.is_authenticated %}
          <div class="app-sidebar" id="appSidebar">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'main.dashboard' or request.endpoint == 'main.admin_dashboard' %}active{% endif %}"
                  href="{{ url_for('main.dashboard') }}"
                >
                  <i class="bi bi-grid-fill me-2"></i><span>Dashboard</span>
                </a>
              </li>
              {% if current_user.role == 'admin' %}
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'main.relatorios' %}active{% endif %}"
                  href="{{ url_for('main.relatorios') }}"
                >
                  <i class="bi bi-graph-up me-2"></i><span>Relatórios</span>
                </a>
              </li>
              {% endif %}
            </ul>
          </div>
        {% endif %}

        <div class="{% if current_user.is_authenticated %}app-content{% else %}container py-4 mt-5 pt-5{% endif %}" id="appContent">
            
            <div class="{% if current_user.is_authenticated %}container-fluid{% endif %}">
                
                {% block content %}{% endblock %} 
                
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // 1. Script para auto fechar alertas após 3 segundos
      document.addEventListener("DOMContentLoaded", function() {
        var alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
          setTimeout(function() {
            var bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 3000); // 3 segundos
        });
      });

      // 2. Controle do Sidebar
      const body = document.body;
      const sidebarToggle = document.getElementById("sidebarToggle");

      if (sidebarToggle) {
        sidebarToggle.addEventListener("click", () => {
            body.classList.toggle("sidebar-collapsed");
        });
        // Desktop começa aberto
        if (window.innerWidth >= 992) {
            body.classList.remove("sidebar-collapsed");
        }
      }

      // 3. Dark Mode
      const toggle = document.getElementById("toggleDarkMode");
      if (toggle) {
        if (localStorage.getItem("dark-mode") === "enabled") {
            body.classList.add("dark-mode");
            toggle.innerHTML = '<i class="bi bi-sun-fill"></i>';
        } else {
            toggle.innerHTML = '<i class="bi bi-moon-stars"></i>';
        }

        toggle.addEventListener("click", () => {
            body.classList.toggle("dark-mode");
            if (body.classList.contains("dark-mode")) {
                localStorage.setItem("dark-mode", "enabled");
                toggle.innerHTML = '<i class="bi bi-sun-fill"></i>';
            } else {
                localStorage.setItem("dark-mode", "disabled");
                toggle.innerHTML = '<i class="bi bi-moon-stars"></i>';
            }
        });
      }
    </script>
  </body>
</html>